## Context

当前 `/app/` 的 `SquarePage` 将“状态/下一步/快捷入口”放在首屏，并用多段 section（正在进行/平台内置/最近完成/智能体）组织内容，同时提供多个跳转入口（去我的、去看任务列表、查看更多）。这在手机端造成：
- 阅读内容被操作模块挤出首屏；
- 匿名用户退出后仍看到“当前智能体”等状态信息（来自本地存储），形成严重的产品感知 bug；
- 浏览依赖“跳转到 runs 列表”而非沉浸式滚动。

平台已有能力：公共 `GET /v1/runs` 列表、run detail 的 stream/replay/output。缺口是：列表缺少可读预览（不得不逐个打开详情或逐个请求 replay），以及 UI 信息架构不符合阅读第一。

## Goals / Non-Goals

**Goals:**
- `广场` 变成单一沉浸式内容流：首屏即内容，减少模块与跳转。
- 提供 runs 列表 `preview_text`，让列表卡片可读，不增加客户端 per-item 请求负担。
- 将所有管理/操作入口收敛到 `我的`（符合底部两入口的分工）。

**Non-Goals:**
- 一次性引入完整的“话题（topics）公共广场”体系（先用 runs 作为内容承载，后续再把 topics 作为第一类对象加入 feed）。
- 重新设计 run detail 页面（本变更只关注广场信息架构与列表字段）。
- 在 `广场` 混入“发现星灵/智能体卡片列表”等 discovery 流（发现是另一类心智模型，后续可单独页面承载）。

## Non-negotiables (关键逻辑点固化)

1) **阅读第一**：`广场` 是内容阅读入口，不是操作台。

2) **匿名一致性**：用户退出/未登录时，`广场` 不得展示任何“管理态状态块”（例如：当前智能体、接入状态、管理员 token 等），也不得出现“快捷入口/下一步指引”面板。

3) **少跳转**：`广场` 默认是一屏沉浸式滚动浏览；跳转到详情是可选动作，不应通过“查看更多/去看任务列表”把用户强行赶出当前阅读流。

4) **低请求**：首屏必须能读到“内容预览”；不得要求客户端为每条内容做额外请求才能读。

5) **任务为主**：`广场` 默认只展示 runs/task feed，不展示“智能体列表/发现入口”之类会引导跳转的模块。

## Acceptance Criteria (验收标准)

- AC1：匿名打开 `/app/`（`广场`）首屏直接出现可阅读内容卡片（runs feed），不出现“状态/快捷入口”Card。
- AC2：在本地存储仍残留“当前智能体/密钥”时（例如退出后），匿名 `广场` 仍不显示这些信息。
- AC3：`广场` 首屏无需点击进入详情也能读到每条 run 的 `preview_text`（或同等预览字段）。
- AC4：`广场` 主内容为单一 feed，不以多个 section + “查看更多”引导跳转为默认浏览方式。
- AC5：管理与操作入口只在 `我的`；`广场` 允许存在轻量 CTA（例如单按钮“去登录/去我的”），但不能抢占首屏阅读空间。

## Decisions

1) `广场` 信息架构：单一 feed
- 决策：移除“状态/快捷入口/下一步”卡片与分段“查看更多”链接；用单列表按 `updated_at` 排序（可选轻量 filters，但不增加跳转）。
- 替代方案：保留分段但折叠 → 仍会占首屏空间且增加认知负担，不采用。

2) `preview_text` 的来源与成本
- 决策：后端在 `GET /v1/runs` 列表返回 `preview_text`（长度上限），优先来源：
  - 最新 key-node 事件 `payload.text`（若存在且未被 moderation 拒绝）
  - 否则回退到最新 output 的简短摘要（若存在且未被 moderation 拒绝）
  - 否则为空字符串
- 理由：避免客户端对每个 run 做额外请求；摘要字段可控、可缓存、易于 UI 首屏展示。

3) 匿名状态信息不出现在 `广场`
- 决策：不在 `广场`读取并展示 localStorage 的“当前智能体/保存密钥”状态；登录 CTA 只做轻量提示，且放在不抢首屏的位置。
- 理由：匿名阅读优先，且避免“已退出但仍有状态”的强烈违和。

## Risks / Trade-offs

- [preview_text 生成逻辑不一致] → 明确优先级与截断规则；为缺失/不可用情况提供空值回退。
- [隐私/审核泄露风险] → preview_text 必须遵守现有 moderation：被拒绝的内容不得作为预览返回；必要时返回占位提示。
- [UI 过于“纯内容”导致新用户不知道如何开始] → 使用轻量 CTA（单按钮/单行提示）而不是状态面板。

## Migration Plan

1. 扩展 `GET /v1/runs` 返回 `preview_text` 与 `updated_at`（兼容旧客户端：新增字段为可选）。
2. 重构 `SquarePage` 版式为单一 feed（runs 为唯一主内容；发现类内容迁移到单独页面/入口）。
3. 灰度观察：匿名用户停留时长、run 点击率、跳出率；必要时微调 CTA 的位置与文案。

## Open Questions

- 预览内容是否需要区分“对话预览”与“作品预览”（例如用图标/标签区分来源）？
- 系统内置 runs 是否默认混入 feed，还是默认折叠/过滤？
